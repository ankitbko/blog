<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Chatbot using Microsoft Bot Framework - Part 3 | F5 - Squashing Bugs</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Chatbot using Microsoft Bot Framework - Part 3" />
<meta name="author" content="Ankit Sinha" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A guide on how to build chat bots using Microsoft Bot Framework - Part 3" />
<meta property="og:description" content="A guide on how to build chat bots using Microsoft Bot Framework - Part 3" />
<link rel="canonical" href="https://ankitbko.github.io/blog/2016/08/ChatBot-using-Microsoft-Bot-Framework-Part-3/" />
<meta property="og:url" content="https://ankitbko.github.io/blog/2016/08/ChatBot-using-Microsoft-Bot-Framework-Part-3/" />
<meta property="og:site_name" content="F5 - Squashing Bugs" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-08-29T00:00:00-05:00" />
<script type="application/ld+json">
{"datePublished":"2016-08-29T00:00:00-05:00","url":"https://ankitbko.github.io/blog/2016/08/ChatBot-using-Microsoft-Bot-Framework-Part-3/","@type":"BlogPosting","dateModified":"2016-08-29T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ankitbko.github.io/blog/2016/08/ChatBot-using-Microsoft-Bot-Framework-Part-3/"},"author":{"@type":"Person","name":"Ankit Sinha"},"headline":"Chatbot using Microsoft Bot Framework - Part 3","description":"A guide on how to build chat bots using Microsoft Bot Framework - Part 3","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://ankitbko.github.io/blog/feed.xml" title="F5 - Squashing Bugs" /><!-- the google_analytics_id gets auto inserted from the config file -->



<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-75679348-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-75679348-1');
</script>


<link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">F5 - Squashing Bugs</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Chatbot using Microsoft Bot Framework - Part 3</h1><p class="page-description">A guide on how to build chat bots using Microsoft Bot Framework - Part 3</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2016-08-29T00:00:00-05:00" itemprop="datePublished">
        Aug 29, 2016
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      7 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#Microsoft Bot Framework">Microsoft Bot Framework</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#LUIS">LUIS</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#Bots">Bots</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#Chat Bots">Chat Bots</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#Conversational Apps">Conversational Apps</a>
        
      
      </p>
    

    
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>This is third part in my series on Chat Bots. In <a href="https://ankitbko.github.io/2016/08/ChatBot-using-Microsoft-Bot-Framework-Part-1/">part one</a> I discussed how chat bots worked and basics of Microsoft Bot Framework. In <a href="https://ankitbko.github.io/2016/08/ChatBot-using-Microsoft-Bot-Framework-Part-2/">part two</a> I talked about LUIS and how it provides intelligence to our bot. I also built a simple bot using LUIS in background which answers questions of who I am. In this post, we will add more features to our bot, and see how LUIS detects entities along with intent. Before we proceed, I would mention that I have added application insight to my bot. As usual, head over to my <a href="https://github.com/ankitbko/MeBot/tree/part3">repo</a> to get the source code.</p>

<p>Since my last post, I have added application insight to the code so that I can view telemetry in Azure. Also I have updated my BotBuilder nuget package to v3.2.</p>

<p>The next feature will let us ask the bot to fetch us articles for a particular topic. More specifically, we can ask bot to search my blog on a particular topic and return us the list posts associated with topic. An example query can be - “show me posts related to docker” should return all the articles having “docker” tag.</p>

<h4 id="enhancing-luis">Enhancing LUIS</h4>

<p>To achieve this, not only will LUIS have to classify the sentence to an intent but also return us entities from the sentence which will act as search terms eg. “docker”. First, we will create a new entity and call it “Tag”. Next, we will add another intent to LUIS named “BlogSearch”. This time when training LUIS for this intent, we can select any word or group of words from the utterance and assign it to our entity as shown below. Just click on the word to assign it to an entity and it should get highlighted with a color.</p>

<p><img src="/blog/assets/images/posts/mebot-3/entity.png" alt="Entity" /></p>

<p>We will train the system with few more utterances. However we quickly see that LUIS is able to recognize entities already trained, but is having hard time with new words such as “Microsoft Bot Framework” as we see in the image below.</p>

<p><img src="/blog/assets/images/posts/mebot-3/failedEntity.png" alt="Failed Entity" /></p>

<p>This is happening because</p>

<ol>
  <li>
    <p>We have not trained our system extensively.</p>
  </li>
  <li>
    <p>LUIS has no way to know that “Microsoft Bot Framework” can be classified as a “Tag” entity since all our previous entities are not even similar to this one.</p>
  </li>
</ol>

<p>We can quickly get around it by utilizing another feature of LUIS called “Phrase List Features”. It allow us to specify comma separated words which LUIS can use interchangeably when detecting an entity. In our case we will provide a list of tags from my blog. We will see that LUIS is now able to detect entities from phrase list we created.</p>

<p><img src="/blog/assets/images/posts/mebot-3/phraselist.png" alt="Phrase List" /></p>

<p>This is an advantage we have with LUIS as it uses Conditional Random Fields(CRF) for entity detection. CRF, unlike some other algorithms, takes neighboring words into account when detecting entities. That is, words preceding and succeeding are important when detecting an entity. With enough training, this allows LUIS to detect words as entities which were not trained before, just by looking at their neighboring words. Once we have sufficiently trained model, let’s go and make changes to the code.</p>

<hr />

<p>As before, we will add another method and decorate it with <code class="language-plaintext highlighter-rouge">[LuisIntent("BlogSearch")]</code>. I have written a class which will get my blog posts and get all the articles I have written along with it’s associated tags. Then I filter the posts based on the “Tag” entity detected by LUIS.
My intent handler is pretty straightforward. I get the list of entities detected by LUIS in <code class="language-plaintext highlighter-rouge">LuisResult</code>. If I find an entity of type “Tag”, I filter the posts comparing its associated tags with the LUIS detected entity. I then pass the list of filtered posts and tag to a private method which formats the response and returns back a string.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nf">LuisIntent</span><span class="p">(</span><span class="s">"BlogSearch"</span><span class="p">)]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">BlogSearch</span><span class="p">(</span><span class="n">IDialogContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">LuisResult</span> <span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">string</span> <span class="n">tag</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
    <span class="kt">string</span> <span class="n">replyText</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>
    <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;</span> <span class="n">posts</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">Post</span><span class="p">&gt;();</span>

    <span class="k">try</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">Entities</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">tag</span> <span class="p">=</span> <span class="n">result</span><span class="p">.</span><span class="n">Entities</span><span class="p">.</span><span class="nf">FirstOrDefault</span><span class="p">(</span><span class="n">e</span> <span class="p">=&gt;</span> <span class="n">e</span><span class="p">.</span><span class="n">Type</span> <span class="p">==</span> <span class="s">"Tag"</span><span class="p">).</span><span class="n">Entity</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">tag</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="kt">var</span> <span class="n">bs</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BlogSearch</span><span class="p">();</span>
            <span class="n">posts</span> <span class="p">=</span> <span class="n">bs</span><span class="p">.</span><span class="nf">GetPostsWithTag</span><span class="p">(</span><span class="n">tag</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">replyText</span> <span class="p">=</span> <span class="nf">GenerateResponseForBlogSearch</span><span class="p">(</span><span class="n">posts</span><span class="p">,</span> <span class="n">tag</span><span class="p">);</span>
        <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="n">replyText</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="s">"Something really bad happened. You can try again later meanwhile I'll check what went wrong."</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">finally</span>
    <span class="p">{</span>
        <span class="n">context</span><span class="p">.</span><span class="nf">Wait</span><span class="p">(</span><span class="n">MessageReceived</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Fireup emulator to check if everything is working as expected. We just added a new feature to our bot with few lines of code. Sweet!!!
<img src="/blog/assets/images/posts/mebot-3/blogsearch.png" alt="Blog Search" /></p>

<hr />

<h4 id="greetings-problem">Greetings Problem</h4>
<p>A new user would most likely start conversation with “Hi” or similar greetings. Currently our bot responds with “I’m sorry. I didn’t understand you.” for any greetings. Well it is not a very good response to give when someone says “Hi”. Let us do something about it. One way would be to create a “Greetings” intent in LUIS and train it to recognize “hi”, “hello” etc. This is what I have been doing till now. However recently I found an excellent <a href="http://www.garypretty.co.uk/2016/08/01/bestmatchdialog-for-microsoft-bot-framework-now-available-via-nuget/">blog post</a> by Garry Petty. He created an implementation of <code class="language-plaintext highlighter-rouge">IDialog</code> to match incoming message to list of strings through regular expression and dispatch it to a handler. So let us go ahead and take his help to solve our little problem here. This approach would also allow me to demonstrate how we can create and use child dialog.</p>

<p>First add reference to his nuget package <a href="https://www.nuget.org/packages/BestMatchDialog/">BestMatchDialog</a>. Next we create <code class="language-plaintext highlighter-rouge">GreetingsDialog</code> and derive it from <code class="language-plaintext highlighter-rouge">BestMatchDialog&lt;object&gt;</code>.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">GreetingsDialog</span><span class="p">:</span> <span class="n">BestMatchDialog</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="p">[</span><span class="nf">BestMatch</span><span class="p">(</span><span class="k">new</span> <span class="kt">string</span><span class="p">[]</span> <span class="p">{</span> <span class="s">"Hi"</span><span class="p">,</span> <span class="s">"Hi There"</span><span class="p">,</span> <span class="s">"Hello there"</span><span class="p">,</span> <span class="s">"Hey"</span><span class="p">,</span> <span class="s">"Hello"</span><span class="p">,</span>
        <span class="s">"Hey there"</span><span class="p">,</span> <span class="s">"Greetings"</span><span class="p">,</span> <span class="s">"Good morning"</span><span class="p">,</span> <span class="s">"Good afternoon"</span><span class="p">,</span> <span class="s">"Good evening"</span><span class="p">,</span> <span class="s">"Good day"</span> <span class="p">},</span>
       <span class="n">threshold</span><span class="p">:</span> <span class="m">0.5</span><span class="p">,</span> <span class="n">ignoreCase</span><span class="p">:</span> <span class="k">false</span><span class="p">,</span> <span class="n">ignoreNonAlphaNumericCharacters</span><span class="p">:</span> <span class="k">false</span><span class="p">)]</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">WelcomeGreeting</span><span class="p">(</span><span class="n">IDialogContext</span> <span class="n">context</span><span class="p">,</span> <span class="kt">string</span> <span class="n">messageText</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="s">"Hello there. How can I help you?"</span><span class="p">);</span>
        <span class="n">context</span><span class="p">.</span><span class="nf">Done</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="p">[</span><span class="nf">BestMatch</span><span class="p">(</span><span class="k">new</span> <span class="kt">string</span><span class="p">[]</span> <span class="p">{</span> <span class="s">"bye"</span><span class="p">,</span> <span class="s">"bye bye"</span><span class="p">,</span> <span class="s">"got to go"</span><span class="p">,</span>
        <span class="s">"see you later"</span><span class="p">,</span> <span class="s">"laters"</span><span class="p">,</span> <span class="s">"adios"</span> <span class="p">})]</span>
    <span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">FarewellGreeting</span><span class="p">(</span><span class="n">IDialogContext</span> <span class="n">context</span><span class="p">,</span> <span class="kt">string</span> <span class="n">messageText</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="s">"Bye. Have a good day."</span><span class="p">);</span>
        <span class="n">context</span><span class="p">.</span><span class="nf">Done</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">override</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">NoMatchHandler</span><span class="p">(</span><span class="n">IDialogContext</span> <span class="n">context</span><span class="p">,</span> <span class="kt">string</span> <span class="n">messageText</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">context</span><span class="p">.</span><span class="nf">Done</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In principle <code class="language-plaintext highlighter-rouge">BestMatchDialog</code> works in same way as <code class="language-plaintext highlighter-rouge">LuisDialog</code>. It would check the message against each of the strings in <code class="language-plaintext highlighter-rouge">BestMatch</code> attribute and calculate a <em>score</em>. Then the handler for the highest score is executed passing in the required context and message. If no handler is found with score above the threshold, <code class="language-plaintext highlighter-rouge">NoMatchHandler</code> is called.
Note in each handler we call <code class="language-plaintext highlighter-rouge">Context.Done</code> instead of <code class="language-plaintext highlighter-rouge">Context.Wait</code>. This is because we don’t want next message to arrive in this Dialog. Instead this Dialog should finish and return back to it’s parent Dialog which is <code class="language-plaintext highlighter-rouge">MeBotLuisDialog</code>. <code class="language-plaintext highlighter-rouge">Context.Done</code> will complete the current Dialog, pop it out of stack and return the result back to parent Dialog. We return <code class="language-plaintext highlighter-rouge">True</code> if we handled the greetings otherwise <code class="language-plaintext highlighter-rouge">False</code>. We then change the <code class="language-plaintext highlighter-rouge">None</code> intent handler in <code class="language-plaintext highlighter-rouge">MeBotLuisDialog</code> to one below -</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="nf">LuisIntent</span><span class="p">(</span><span class="s">"None"</span><span class="p">)]</span>
<span class="p">[</span><span class="nf">LuisIntent</span><span class="p">(</span><span class="s">""</span><span class="p">)]</span>
<span class="k">public</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">None</span><span class="p">(</span><span class="n">IDialogContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IAwaitable</span><span class="p">&lt;</span><span class="n">IMessageActivity</span><span class="p">&gt;</span> <span class="n">message</span><span class="p">,</span> <span class="n">LuisResult</span> <span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">cts</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CancellationTokenSource</span><span class="p">();</span>
    <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">Forward</span><span class="p">(</span><span class="k">new</span> <span class="nf">GreetingsDialog</span><span class="p">(),</span> <span class="n">GreetingDialogDone</span><span class="p">,</span> <span class="k">await</span> <span class="n">message</span><span class="p">,</span> <span class="n">cts</span><span class="p">.</span><span class="n">Token</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">private</span> <span class="k">async</span> <span class="n">Task</span> <span class="nf">GreetingDialogDone</span><span class="p">(</span><span class="n">IDialogContext</span> <span class="n">context</span><span class="p">,</span> <span class="n">IAwaitable</span><span class="p">&lt;</span><span class="kt">bool</span><span class="p">&gt;</span> <span class="n">result</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">success</span> <span class="p">=</span> <span class="k">await</span> <span class="n">result</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(!</span><span class="n">success</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">context</span><span class="p">.</span><span class="nf">PostAsync</span><span class="p">(</span><span class="s">"I'm sorry. I didn't understand you."</span><span class="p">);</span>

    <span class="n">context</span><span class="p">.</span><span class="nf">Wait</span><span class="p">(</span><span class="n">MessageReceived</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>In None intent handler we call <code class="language-plaintext highlighter-rouge">context.Forward</code> which will create a child dialog of type <code class="language-plaintext highlighter-rouge">GreetingsDialog</code>, push it to top of stack and call it’s <code class="language-plaintext highlighter-rouge">StartAsync</code> method passing message as argument. <code class="language-plaintext highlighter-rouge">GreetingDialogDone</code> is called once the child dialog completes i.e. child dialog calls <code class="language-plaintext highlighter-rouge">context.Done</code>.</p>

<p>Well this solves our little problem of handling greetings. One last thing we need to do. There should be a way for user to ask for help. We will create another LUIS intent called “Help” and train it with few utterances such as “need help”. This will allow user flexibility to ask for help anytime. From our bot, we would return the functionality that our bot can do similar to what we return for ConversationUpdate ActivityType.</p>

<p>In this article we enhanced our bot to search through my blog and filter articles based on associated tags. We also created a child dialog to handle greetings and a way for user to get help. In next post, we will get into FormFlow and make our bot bit more conversational. Till then, if you have any questions or feedback post a comment.</p>

  </div>
  <div class="PageNavigation">
  
  <div class="prevDiv">
    <a class="prev" href="/blog/2016/08/ChatBot-using-Microsoft-Bot-Framework-Part-2/">&laquo; Chatbot using Microsoft Bot Framework - Part 2</a>
  </div>
  
  
  <div class="nextDiv">
    <a class="next" href="/blog/2016/09/ChatBot-using-Microsoft-Bot-Framework-Part-4/">Chatbot using Microsoft Bot Framework - Part 4 &raquo;</a>
  </div>
  
</div>
<!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="ankitbko/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/2016/08/ChatBot-using-Microsoft-Bot-Framework-Part-3/" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
        <ul class="contact-list">
          <li class="p-name">Ankit Sinha</li>
          
        </ul>
      </div>
      <div class="footer-col">
        <p>A technology blog focusing on random stuff</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/ankitbko" title="ankitbko"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/ankitbko" title="ankitbko"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
